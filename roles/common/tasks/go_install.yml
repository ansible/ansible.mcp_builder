---
# Go installation tasks

- name: Create Go installation directory
  ansible.builtin.file:
    path: /usr/local
    state: directory
    mode: "0755"
  become: true
  when: not common_go_installed

- name: Download and extract Go
  ansible.builtin.unarchive:
    src: "https://golang.org/dl/go{{ common_golang_version }}.linux-amd64.tar.gz"
    dest: /usr/local
    remote_src: true
    owner: root
    group: root
    mode: "0755"
    creates: /usr/local/go/bin/go
  become: true
  when: not common_go_installed

- name: Set Go environment variables
  ansible.builtin.lineinfile:
    path: /etc/environment
    line: "{{ go_env_item }}"
    create: true
    mode: "0644"
  loop:
    - 'PATH="/usr/local/go/bin:$PATH"'
  loop_control:
    loop_var: go_env_item
  become: true
  when: not common_go_installed

- name: Mark Go as installed
  ansible.builtin.set_fact:
    common_go_installed: true
  when: not common_go_installed
