---
{% for registry in registries|sort(attribute="name") if registry.registry %}
- name: {{ registry.name }}
  servers:
  {% for server in registry.registry|sort(attribute="name") %}
    - repository:
        {% for key, value in server.items() %}
        {% if key == 'package' and value is string and value.startswith('@') %}
        {{ key }}: "{{ value }}"
        {% elif value is string %}
        {{ key }}: {{ value }}
        {% elif value is mapping %}
        {{ key }}:
          {% for item_key, item_value in value.items() %}
          {{ item_key }}: {{ item_value }}
          {% endfor %}
        {% elif value is sequence %}
        {% if value | length > 0 %}
        {{ key }}:
          {% for item in value %}
          - {{ item }}
          {% endfor %}
        {% else %}
        {{ key }}: []
        {% endif %}
        {% else %}
        {{ key }}: {{ value }}
        {% endif %}
        {% endfor %}
  {% endfor %}
{% endfor %}
